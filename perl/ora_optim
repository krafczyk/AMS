#!/bin/sh
sqlplus amsdes/@@@@@amsdb  <<!

!

ALTER MATERIALIZED VIEW LOG FORCE ON
"AMSDES"."JOBS"
ADD ROWID, PRIMARY KEY, SEQUENCE("JOBNAME","CID","DID","TIME","TRIGGERS","TIMEOUT","TIMESTAMP","CPUTIME","MIPS","PID","REALTRIGGERS")
INCLUDING NEW VALUES;

CREATE MATERIALIZED VIEW "SYSTEM"."MV$$_01F60001"
REFRESH FAST WITH ROWID
ENABLE QUERY REWRITE
AS SELECT AMSDES.JOBS.TIMESTAMP C1, AMSDES.JOBS.TIME C2, AMSDES.JOBS.CID C3,  MIN("AMSDES"."JOBS"."JID")
M5, MAX("AMSDES"."JOBS"."JID") M6, COUNT("AMSDES"."JOBS"."JID") M7, SUM("AMSDES"."JOBS"."REALTRIGGERS")
M8, COUNT("AMSDES"."JOBS"."REALTRIGGERS") M9, MIN("AMSDES"."JOBS"."TIME")
M10, MAX("AMSDES"."JOBS"."TIME") M11, MAX("AMSDES"."JOBS"."TIMESTAMP")
M12, SUM("AMSDES"."JOBS"."TRIGGERS") M13, COUNT("AMSDES"."JOBS"."TRIGGERS")
M14, COUNT(*) M15 FROM AMSDES.JOBS GROUP BY AMSDES.JOBS.TIMESTAMP, AMSDES.JOBS.TIME,
AMSDES.JOBS.CID;

begin
dbms_stats.gather_table_stats('"SYSTEM"','"MV$$_01F60001"',NULL,dbms_stats.auto_sample_size);
end;
/

CREATE MATERIALIZED VIEW "SYSTEM"."MV$$_01F60000"
REFRESH FAST WITH ROWID
ENABLE QUERY REWRITE
AS SELECT AMSDES.JOBS.REALTRIGGERS C1, AMSDES.JOBS.PID C2, AMSDES.JOBS.MIPS C3,
AMSDES.JOBS.TIMEOUT C4, AMSDES.JOBS.TIME C5, AMSDES.JOBS.DID C6, AMSDES.JOBS.JOBNAME
C7,  MIN("AMSDES"."JOBS"."JID") M5, MAX("AMSDES"."JOBS"."JID") M6, COUNT("AMSDES"."JOBS"."JID")
M7, SUM("AMSDES"."JOBS"."REALTRIGGERS") M8, COUNT("AMSDES"."JOBS"."REALTRIGGERS")
M9, MIN("AMSDES"."JOBS"."TIME") M10, MAX("AMSDES"."JOBS"."TIME") M11,
MAX("AMSDES"."JOBS"."TIMESTAMP") M12, SUM("AMSDES"."JOBS"."TRIGGERS")
M13, COUNT("AMSDES"."JOBS"."TRIGGERS") M14, COUNT(*) M15 FROM AMSDES.JOBS
GROUP BY AMSDES.JOBS.REALTRIGGERS, AMSDES.JOBS.PID, AMSDES.JOBS.MIPS,
AMSDES.JOBS.TIMEOUT, AMSDES.JOBS.TIME, AMSDES.JOBS.DID, AMSDES.JOBS.JOBNAME;

begin
dbms_stats.gather_table_stats('"SYSTEM"','"MV$$_01F60000"',NULL,dbms_stats.auto_sample_size);
end;
/

CREATE INDEX "SYSTEM"."MV$$_01F60001_IDX$$_01F60030"
ON "SYSTEM"."MV$$_01F60001"
("C3","C1")
COMPUTE STATISTICS;

CREATE BITMAP INDEX "SYSTEM"."MV$$_01F60000_IDX$$_01F60031"
ON "SYSTEM"."MV$$_01F60000"
("C6")
COMPUTE STATISTICS;
