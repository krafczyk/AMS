// TOF global constants definition
//geometry :
const integer SCMXBR=14; // max nmb of bars/layer
const integer SCLRS=4; // nmb of layers in TOF-systems
const integer SCBRS[SCLRS]={14,14,14,14}; // nmb of bars per layer (top->bot)
const integer SCROTN=1000; // start nmb of abs. numbering of TOF rot. matrixes
const integer SCBTPN=5;    //nmb of sc. bar types (different by length now)
const integer SCCHMX=SCLRS*SCMXBR*2; //MAX scint. channels
const integer SCBLMX=SCLRS*SCMXBR;   //MAX scint. bars*layers
//MC
const integer AMSDISL=500;//max length of distributions in AMSDistr class
const integer SCANPNT=11; //scan points in MC/REC t/a-calibration 
const integer SCTBMX=10000;//length of MC "flash-ADC" buffer
const integer SCSBMX=500;//2*shaper_buffer_size(SHOUL BE ABOVE 2*9.3*tfall/shaptb) 
const integer SCWORM=64;// Max.length (in 16-bits words) in bit-stream class
const integer SCBITM=SCWORM*16;// same in bits
//DAQ/RECO
const integer SCTHMX1=8;//max trigger hits( multpl.factor=2 for tr/ftdc/adc, =4 for stdc)
const integer SCTHMX2=8;//max fast TDC (history) hits  
const integer SCTHMX3=4;//max slow TDC (stretcher) hits
const integer SCTHMX4=8;//max ADC (time_over_threshold) hits  
const integer SCJSTA=20;   //size of Job-statistics array
const integer SCCSTA=10;   //size of Channel-statistics array
const integer SCACRFP=5;   // ref. points for 1-channel ampl. calibration
//===========================================================================
// 
// --------------> Class for "time-stable"  parameters :
class TOFDBc {  
//
private:
// geom. constants:
  static integer _brtype[SCBLMX];  // map of bar types (diff. by length)
  static integer _plrotm[SCLRS]; // TOF planes rotation mask
  static geant _brlen[SCBTPN]; // bar lengthes for SCBTPN types
  static geant _supstr[10]; // supp. structure parameters
  static geant _plnstr[15]; // sc. plane structure param.
// MC/RECO constants:
  static geant _edep2ph;     // MC edep(Mev)-to-Photons convertion
  static geant _fladctb;     // MC flash-ADC time binning (ns)
  static geant _shaptb;      // MC shaper pulse time binning
  static geant _shrtim;      // MC shaper pulse rise time (ns)
  static geant _shftim;      // MC shaper pulse fall time (ns)
  static geant _tdcbin[4];   // pipe-line TDC binning for ftdc/stdc/adca/adcd
  static geant _trigtb;      // MC time-binning in logic(trig) pulse handling
  static geant _strflu;      // Stretcher "end-mark" time fluctuations (ns)
  static geant _daqpwd[15];  // MC DAQ-system pulse_widths/dead_times/...
  static geant _di2anr;      // default(sim/rec of MC-data) dinode-to-anode signal ratio
  static geant _strrat;      // default(------------------) stretcher ratio
  static geant _strjit1;     // "start" signal jitter at stretcher input(ns) 
  static geant _strjit2;     // "stop"(FT) signal jitter at stretcher input(ns)
  static geant _ftdelf;      // FastTrigger (FT) fixed (by h/w) delay (ns)
  static geant _ftdelm;      // FT max delay (allowed by stretcher logic) (ns)
  static geant _accdel;      // Lev-1 signal delay with respect to FT (ns)
  static geant _fstdcd;      // Same hit(up-edge) relative delay of slow- wrt hist-TDC
  static geant _fatdcd;      // Same hit(up-edge) rel.delay of A(d)- wrt hist-TDC
  static integer _pbonup;    // set phase bit "on" for leading(up) edge (yes/no->1/0)
  
  
  Some default values (may be changed in final version !) :
  
//---> bar lengthes (cm) for each of SCBTPN types :
geant TOFDBc::_brlen[SCBTPN]={
  72.6,99.6,118.6,130.6,135.4
};
//---> plane rotation mask for 4 layers (1/0 -> rotated/not):
integer TOFDBc::_plrotm[SCLRS]={
  1,0,0,1
};
//---> honeycomb supporting str. data:
geant TOFDBc::_supstr[10]={
   59.9,    // i=1    Z-coo of TOP honeycomb (BOT-side)
  -59.9,    //  =2    Z-coo    BOT           (TOP     )
   0.,0.,  //  =3,4  X/Y-shifts of TOP honeycomb centre in Mother r.s.
   0.,0.,  //  =5,6                BOT
   10.,78.,//  =7,8  DZ/R-outer of both honeycomb supports
   0.,0.   //  =9,10 spare
};
//---> sc. plane design parameters:
geant TOFDBc::_plnstr[15]={
  0.,0.,  // i=1,2  Z-gap between honeycomb and outer/inner scint. planes
    1.25,  // i=3    Z-shift of even/odd bars in plane (0 -> flat plane)
     0.6,  // i=4    X(Y)-overlaping(incl. sc_cover) of even/odd bars (0 for flat)
     11., // i=5    sc. bar width
      1., // i=6    sc. bar thickness
    0.05, // i=7    sc_cover thickness (carb.fiber)
 10.,10.,2.5, // i=8-10 width/length/thickness (x/y/z) of PMT shielding box.
  5.,         // i=11 dist. in x-y plane from sc. edge to PMT box.
  0.7,        // i=12 Z-shift of sc.bar/PMT-box centers (depends on par. i=10)
  0.,0.,0.    // i=13-15 spare
};
//---> Initialize TOF MC/RECO "time-stable" parameters :
//
  geant TOFDBc::_edep2ph={8000.};// edep(Mev)-to-Photons convertion
  geant TOFDBc::_fladctb=0.05;   // MC flash-ADC time binning (ns)
  geant TOFDBc::_shaptb=2.;      // MC shaper pulse time binning
  geant TOFDBc::_shrtim=0.5;     // MC shaper pulse rise time (ns)
  geant TOFDBc::_shftim=50.;     // MC shaper pulse fall time (ns)
  geant TOFDBc::_strflu=0.;   // Stretcher "end-mark" time fluctuations (ns)
  geant TOFDBc::_tdcbin[4]={
    1.,                            // pipe/line TDC binning for fast-tdc meas.
    1.,                            // pipe/line TDC binning for slow-tdc meas.
    2.,                            // pipe/line TDC binning for adc-anode meas.
    2.                             // pipe/line TDC binning for adc-dinode meas.
  };
  geant TOFDBc::_daqpwd[15]={
    30.,       // pulse width of "z>=1" trig. signal (ns)
    30.,       // pulse width of "z>1" trig. signal
    30.,       // pulse width of "z>2" trig. signal
    10.,       // double pulse resolution of fast(history) TDC (ns)
    2000.,     // min. double pulse resolution of slow TDC (ns)
    500.,      // dead time of anode TovT measurements (ns)
    500.,      // dead time of dinode TovT measurements (ns)
    2.,        // discr. dead time of "z>=1" trig. (ns)
    2.,        // discr. dead time of "z>1" trig. (ns)
    2.,        // discr. dead time of "z>2" trig. (ns)
    0.05,      // fast discr.(comparator) internal accuracy(ns) + (?) to have exp.resol
    0.5,       // min. pulse duration (ns) of fast discr.(comparator)
    20.,       // pulse width of FT-signal (ns) 
    0.,        // spare 
    0.         // spare 
  };
  geant TOFDBc::_trigtb=0.5;  // MC time-bin in logic(trig) pulse handling (ns)
  geant TOFDBc::_di2anr=0.1;  // dinode->anode signal ratio (default,mc-data)
  geant TOFDBc::_strrat=40.;  // stretcher ratio (default,mc-data)
  geant TOFDBc::_strjit1=0.;  // "start"-pulse jitter at stretcher input
  geant TOFDBc::_strjit2=0.;  // "stop"(FT)-pulse jitter at stretcher input
  geant TOFDBc::_accdel=5000.;//Lev-1 signal delay with respect to FT (ns)
  geant TOFDBc::_ftdelf=20.;  // FastTrigger (FT) fixed (by h/w) delay (ns)
  geant TOFDBc::_ftdelm=100.; // FT max delay (allowed by stretcher logic) (ns)
  geant TOFDBc::_fstdcd=5.;   // Same hit(up-edge) relative delay in fast-slow TDC
  geant TOFDBc::_fatdcd=5.;   // Same hit(up-edge) relative delay in fast-A(D) TDC
  integer TOFDBc::_pbonup=1;  // set phase-bit for leading(up) edge (yes/no->1/0) 
   
//===================================================================
// 
// --------------> Class for general "time-variable"  parameters :
class TOFVarp {  
//
private:
// ---> TOF DAQ-system thresholds :
  geant _daqthr[5];   // DAQ-system thresholds (defaults)
// ---> Cuts :
  geant _cuts[10];                    
          //  (1) fstdw   -> t-window to identify same hit in fast/slow_tdc
          //  (2) hiscutb -> "befor"-cut in time history (ns)
          //  (3) hiscuta -> "after"-cut in time history (ns)
//
//===================================================================
//
class TOFJobStat{
//
private:
  static integer mccount[SCJSTA];// event passed MC-cut "i"
//          i=0 -> entries
  static integer recount[SCJSTA];// event passed RECO-cut "i"
//          i=0 -> entries
//          i=1 -> DAQ->RawEvent OK
//          i=2 -> RawEv-validate OK
//           =3 -> RawEvent->RawCluster OK
//           =4 -> RawCluster->Cluster OK
//           =5 -> spare
//          i=6 -> entries to TZSl-calibration 
//           =7 -> TZSl:: multiplicity OK
//           =8 -> TZSl:  beta OK
//           =9 -> spare
//
//          =10 -> entries to AMPL-calibration
//          =11 -> AMPL:: multiplicity OK
//          =12 -> AMPL:  matching with track OK
//         13-19 spare
//------
  static integer chcount[SCCHMX][SCCSTA];//channel statistics
//                              [0] -> h/w-status="ON" frequency 
//                              [1] -> "FTDC-ON"  (Nftdc>0)
//                              [2] -> "STDC-ON"  (Nstdc>0)
//                              [3] -> "ADCA-ON"  (Nadca>0)
//                              [4] -> "ADCD-ON"  (Nadcd>0)
//                              [5] -> "FTDC-1hit"  (Nftdc=1)
//                              [6] -> "STDC-1hit"  (Nstdc=1)
//                              [7] -> "ADCA-1hit"  (Nadca=1)
//                              [8] -> "ADCD-1hit"  (Nadcd=1)
//------
  static integer brcount[SCBLMX][SCCSTA];// bar statistics
//                               [0] -> h/w-status="ON" frequency
//                               [1] -> "multipl-OK"
//                               [2] -> "history-OK"

//===================================================================
// class to store TOF_bar calibration constants :
class TOFBrcal{
//
private:
  integer softid;  // LBB
  integer status[2]; // each side status (1/0->dead/alive)
  geant gaina[2]; // A-chain gain(PMT mainly)| (side-1/2; relative to some
  geant gaind[2]; // D-chain gain(PMT mainly)| reference bar of given type)
  geant qathr;  // A-TovT-discr. threshold (Qin(pC) at shaper entry)
  geant qdthr;  // D-TovT-discr. threshold (.......................)
  geant an2dir[2]; // anode-to-dinode signal ratio (in unsatur. region)
  geant asatl;  // anode_chain saturation limit(mev)(incl. PM,Shaper,...)
//                  (i.e. below use anode data, above  - dinode data)
  geant tthr;   // Time-discr. threshold (mV)
  geant strat[2];  // Stratcher ratio (side 1/2)
  geant fstrd;  // same hit time difference between fast/slow TDC (ns)
  geant tzero;  // T0 (ns)
  geant slope; // slope for T vs (exp(-Am1/shft)+exp(-Am2/shft))
  geant td2pos[2];// t-diff->position conv. factor(cm/ns) and error(cm)
// for (at least) reference bar (in each bar type group) :
  geant mip2q;// 2-sides A-signal(pC/Mev) (at Y=0.)
  geant yscanp[SCANPNT]; // Y-positions of the scan points(bar type depend)
  geant relout[SCANPNT]; // Relative(to Y=0) 2-Sides(sum) Light output
//(if some PMTs in some bar are dead, curve should be MC-calc. or measured)  
//
// standard TovT-chain calibration: Shaper Qin -> Time_over_Thresh (TovT) : 
  geant logqin[SCACRFP]; // Log(Qin) ref. points (Qin in pC)
  geant tovta[SCACRFP];  // A-type TovT output (in ns)
  geant tovtd[SCACRFP];  // D-type TovT output (in ns)
//
