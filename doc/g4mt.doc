//  Geant4 Multithreading + ams software openmp

only icc 15 openmp version is supported

using G4 Threading model + amssoftware basically as it is, with few exceptions.


   thread id is taken from geant4 , not from openmp


 openmp pragmas not working:

 barrier, master,parallel (therefore no copyin directives)

openmp locks are not working
openmp functions lke omp_get_thread_num and others are not working

barrier was emulated using AMSEvent::SetBarrier


//Status

to compile setenv G4MULTITHREADED 1

or use vars in /Offline/vdev/install/build410_mt.sh

 examples/g4mt.job is runing example

to activate multithreading  use same MISC=nthr datacards
//TBD
 

// Features

the events in the root file will be not ordered by default (MISC 29=0 will change this with some memory penalty), however amschain getentryordered can be used to get the ordered events

richlip reconstruction not working (common blocks need to be fixed by authors)

RNDM hase still no reproducibility, to be worked in , however it does not change quality of results

Number of threads can not be changed dynamically /may be changed in the future//

Nuclear simulation with DPMJET2.5 model still have some runtime problems in MT mode  , to be worked on

Software not checked:  Trigger simulation


DAQ File Writing not ordered (not currently to order it via datacard, to be work out)

//Performance

 memory use ~ 1.5 gb+0.1gb*nthr 
vmemory use  ~ 2.5 gb+0.25gb*thr
Practical example:  72 thread jobs vmemory < 20 gb memory < 10 gb

 MT Overhewad (protons 1000-200 gev)
Threads       Sec/Event/Thread

1                2.2

2                2.25

4                2.33

8                2.5

16               2.72
             
32               3.02

36                3.25

2X36 [HT]         4.7    +35-40%
