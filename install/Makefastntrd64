#
SHELL=/bin/sh
#
ifndef AMSWD
AMSWD := ..
endif
ARCH         := $(shell $(ROOTSYS)/bin/root-config --arch )
PLATFORM      =  Linux
PREFIX        = $(AMSWD)/bin/$(ARCH)/fastntrd/
DEPDIR        = $(PREFIX)/dep
AMSPRG        = $(AMSWD)/exe/$(ARCH)/fastntrd.exe
AMSLIB        = $(AMSWD)/lib/$(ARCH)/libntuple_slc4_PG.a
ifeq ($(wildcard $(ROOTSYS)/include/Compression.h),)
    LZMAL =
else
    DEFINES  +=  -D__LZMA__
    LZMAL = -llzma
endif
SLC6system=
ifneq "$(wildcard /etc/redhat-release)" ""
 SLC6system := $(shell cat /etc/redhat-release | grep "Scientific Linux CERN SLC release 6")
endif


ifeq ($(ARCH),linuxx8664gcc)

# DEFAULTS 
 RH9add=-pthread  

CFLAGS=      -D__BATCH__  -I../include   -D__LINUXGNU__ -D__WRITEROOT__ -D__ROOTPOINTERS__ -I$(ROOTSYS)/include -O
FFLAGS=   -O -I../include
DFLAGS=    -g   -I/usr/include  -I$(AMSWD)/include -I../include/stl 
#LDFLAGS=  -static     -lnsl -L/usr/local/lib    -lm  -lg2c 
LDFLAGS= -O -rdynamic -static-libgcc -L$(ROOTSYS)/lib -L$(AMSWD)/lib/$(ARCH)  -Bstatic -lntuple_slc4_PG -lRoot  $(LZMAL) -lcrypt -lcrypto -L//afs/cern.ch/exp/ams/Offline/CERN/2005.gcc64/lib    -lpacklib -lmathlib -lkernlib -lgfortran -Bdynamic -lshift -ldl  -Bstatic -lc -lfreetype -lpcre -lncurses -pthread   -lXrdClient -lXrd -lXrdNet -lXrdOuc -lXrdSys   -lrt
CC=g++ 
FF=gfortran 
LD=g++ 
BIN=$(AMSWD)/bin/$(ARCH)/fastntrd/
EXE=$(AMSWD)/exe/$(ARCH)
TIMEL=
endif
ifeq ($(ARCH),linuxx8664icc)

# DEFAULTS 
 RH9add=-pthread  

CFLAGS=      -D__BATCH__  -I../include   -D__LINUXGNU__ -D__WRITEROOT__ -D__ROOTPOINTERS__ -I$(ROOTSYS)/include -O
FFLAGS=   -O -I../include
DFLAGS=    -g   -I/usr/include  -I$(AMSWD)/include -I../include/stl 
#LDFLAGS=  -static     -lnsl -L/usr/local/lib    -lm  -lg2c 
  INTELDIR=/afs/cern.ch/ams/local2/opt/intel/
  INTELVER=Compiler/11.1/073/
ifdef SLC6system
  INTELVER=composer_xe_2011_sp1.9.293/compiler/
endif
LDFLAGS= -rdynamic -static-intel -L$(ROOTSYS)/lib  -L$(AMSWD)/lib/$(ARCH)  -Bstatic -lntuple_slc4_PG  -lRoot $(LZMAL) -lcrypt -lcrypto -L//afs/cern.ch/exp/ams/Offline/CERN/2005/lib    -lpacklib -lmathlib -lkernlib  -Bdynamic -lshift -ldl -lrt  -Bstatic  -lfreetype -lpcre  -lncurses -pthread   -lXrdClient -lXrd -lXrdNet -lXrdOuc -lXrdSys -L$(INTELDIR)/$(INTELVER)/lib/intel64/ -lifport -lifcoremt -limf  -lipgo -lirc_s -limf -lirc

CC=$(INTELDIR)/$(INTELVER)/bin/intel64/icc  -openmp -axssse3
FF=$(INTELDIR)/$(INTELVER)/bin/intel64/ifort  -openmp -axssse3
LD=$(INTELDIR)/$(INTELVER)/bin/intel64/icpc  -openmp -axssse3 
BIN=$(AMSWD)/bin/$(ARCH)/fastntrd/
EXE=$(AMSWD)/exe/$(ARCH)
TIMEL=
endif

#
#
#
SCC=../CC/
FILES= $(SCC)fastntrd.C ../F/fntread.F ../CC/rootread.C  ../CC/commonsi.C
OBJECTS= $(BIN)fastntrd.o  $(BIN)fntread.o $(BIN)rootread.o $(BIN)commonsi.o
$(AMSPRG):	$(BIN)fastntrd.o  $(BIN)fntread.o $(BIN)rootread.o $(BIN)commonsi.o $(AMSLLIB)
	@if ! [ -d $(EXE) ] ; then mkdir -p $(EXE); fi
	$(LD) -v -o $(AMSPRG) $(OBJECTS) $(TIMEL) $(LDFLAGS)

	chmod +x  $(EXE)/fastntrd.exe 


$(BIN)fastntrd.o:         $(SCC)fastntrd.C
	@if ! [ -d $(BIN) ] ; then mkdir -p $(BIN); fi
	$(CC) -c $(CFLAGS) $(SCC)fastntrd.C -o $(BIN)fastntrd.o


$(BIN)fntread.o:         ../F/fntread.F
	$(FF) -c $(FFLAGS) ../F/fntread.F -o $(BIN)fntread.o

$(BIN)rootread.o:    	 $(SCC)rootread.C
	$(CC) -c $(CFLAGS) $(SCC)rootread.C -o $(BIN)rootread.o

$(BIN)commonsi.o:    	 $(SCC)commonsi.C
	$(CC) -c $(CFLAGS) -D__FASTNTRD__ $(SCC)commonsi.C -o $(BIN)commonsi.o

 

depend: 	
	makedepend -f Mopt -- $(DFLAGS) -- $(FILES) -p$(BIN)


        

# DO NOT DELETE THIS LINE -- make depend depends on it.

