// $Id: README,v 1.1 2009/06/10 10:26:34 shaino Exp $

Tracker alignment procedure

[0] What you need
 1. Gbatch (later than as of 10/June/2009) which contains TrAlignFit class 
    and Tracker analysis classes compiled with PGTRACK option
 2. Event DST files in form of AMSRoot branch in ROOT TTree
 3. In order to keep the highest performance, all the hit coordinates 
    are kept in the memory during the iteration procedure. 
    The memory consumption for 10^6 events is about 400 MB. 
    You need to provide enough memory corresponding to number 
    of events processed.

[1] How to run
 1. Go to the dir "AMS/tkalign"
 2. Check "rootlogon.C" if the library path is correct
 3. Compile and run macro "alignfit.C" to generate a temporary file as follows

root [0] .x alignfit.C+("1210*.root","alignfit.dat","tkdbc.dat.nominal",1)

 where 
 the 1st. argument is DST files to be added to AMSChain
 the 2nd. argument is the name of the output temporary file
 the 3rd. argument is the TkDBc data to be used as a reference
 the 4th. argument is the flag if hit coordinates are rebuild or not
                      which should be 1 if TkDBc is specified  (default=1)
 the 5th. argument is number of events to be processed
                      the default value (=0) indicates all the events

 the temporary file contains sets of hit coordinates to be used 
 for the alignment iteration.
 If you want to provide sensor alignment data, put it at the same directory 
 with the name "tksens.dat"
 If not provided, the nominal values (hard coded in TkDBc.C) are used. 
 "AMS/tkalign/refs/tksens.dat" is an example (same as the nominal one).

 4. For the TkDBc file, you can find two examples at "AMS/tkalign/refs"
  tkdbc.dat.nominal       : nominal position (no alignment correction)
  tkdbc.dat.aligned_May08 : with alignment data obtaiend with May/08 CR data

 5. After generating the temporary file you can start 
    the iteration process as

root [1] .x alignfit.C+("alignfit.dat", "tkdbc.dat.nominal")

 where
 the 1st. argument is the name of the temporary file
 the 2nd. argument is the TkDBc data to be used as a reference
 the 3rd. argument is number of events to be processed
                      the default value (=0) indicates all the events
 the 4th. argument is event skip rate for the case when you want to study 
                      the statistical dependence of the alignment result
                      the default value (=0) indicates no skip

[2] The output files
 1. After 20 iterations it generates the following output files
    tkdbc.dat     : the new TkDBc file with the aligned parameters
    alignfit.root : root file containing status of each iteration
    align.dat.new : text file containing alignment parameters
                    with the format (be careful on the units and factors)

          tkid dx/mm dy/mm dz/mm alpha*600/rad beta*600/rad gamma*600/rad

                    which can be read by TkDBc::readAlignmentAngles()

 2. in the "AMS/tkalign/refs" directory you can find some output files 
    for the May/2008 cosmic ray data


  Any comments and questions are to be sent to Sadakazu.Haino@pg.infn.it
